# 第5回：DBを「使う」  
— ただし評価しない —

第5回では、第3回・第4回で保存してきたデータを  
**はじめて Bot の返答に使います。**

ただし、この回でも  
**判断・評価・比較は一切行いません。**

---

## 🎯 この回のゴール

この回のゴールは、次の1点です。

> **SQLite に保存されたデータを読み出し、  
> 解釈を伴わない「事実」だけをユーザーに返せること**

具体的には：

- DBからデータを取得できる
- 自分自身のデータのみを扱う
- 数字を評価や意味づけに使わない
- 第4回で決めた制限を守ったまま実装できる

---

## 前提条件

以下を満たしていることを前提に進めます。

- 第4回を完了している
- ファイル構成が以下になっている

```

source/
├─ index.js
├─ db.js
└─ responses.js

```

- `/hello` コマンドが動作している
- SQLite にログが保存されている
- `git_practice` フォルダを継続使用している

---

## 今回やらないこと（重要）

この回では、以下は **意図的に行いません**。

- 他ユーザーとの比較
- スコア化・ランキング
- 良し悪しの評価
- 行動改善の提案
- グラフ表示

**理由：**  
メンタル系サーバーでは、  
「評価されること」自体が負荷になるためです。

---

## 1️⃣ 第4回からの変更点

### 第4回
- データを保存するだけ
- Botの返答は固定テンプレ
- 振る舞いを制限する回

### 第5回
- DBからデータを読み出す
- 件数という「事実」を返す
- ただし解釈しない

👉 **保存 → 使用 の最小ステップ**です。

---

## 2️⃣ 今回追加するコマンド

この回では、次のコマンドを追加します。

```

/count

```

### /count の振る舞い

- 自分自身の記録回数のみを表示する
- 他人のデータは一切扱わない
- 件数以外の情報は返さない

例：

```

これまでの記録回数は 3 回です。

````

※ 励まし・評価・コメントは入りません

---

## 3️⃣ source の役割分担（再確認）

### index.js
- コマンドの受付
- DB処理の呼び出し
- responses から文言を選んで返す

👉 ロジックは書くが、文章は書かない

---

### db.js
- ログの保存
- 件数の取得（COUNT）

👉 判断・評価・加工はしない

---

### responses.js
- Botが返してよい文章だけを定義

👉 「言っていいこと」をここに閉じ込める

---

## 4️⃣ 実装のポイント

### DB取得処理

- `COUNT(*)` のみ使用
- `WHERE user_id = ?` を必ず指定
- 他ユーザーの情報は扱わない

---

### 返答文について

- 数字は事実として返す
- 多い・少ない・すごい等は使わない
- 感情的な言葉を足さない

---

## 5️⃣ 実行手順（確認）

第2回で `npm init -y` 済み前提です。

```bash
npm install discord.js sqlite3 dotenv
node index.js
````

---

## 6️⃣ Gitでの保存

この回の変更も、必ず Git に保存します。

```bash
git add .
git commit -m "add count command without evaluation"
git push
```

**評価しない設計も、履歴として残します。**

---

## ✅ チェックリスト

* [ ] `/count` が実行できる
* [ ] 自分の件数のみが表示される
* [ ] 評価的な表現が含まれていない
* [ ] responses.js に文言が集約されている
* [ ] 他ユーザーの情報が出てこない
* [ ] Git に commit されている

---

## 🚧 よくある詰まりポイント

### `/count` が表示されない

* Botを追加したサーバーが `GUILD_ID` と一致しているか確認
* Botを再起動してコマンド再登録を確認

---

### data.db が Git に入ってしまった

* `.gitignore` に `**/data.db` を追加する

---

### 数字に意味を持たせたくなる

→ **それをしないための回です**
→ 第6回以降に進みます

---

## 次回予告（第6回）

第6回では、
**はじめて Gemini API を扱います。**

* 自由生成はしません
* 第4回・第5回で作った制限の中で使います
* Botの文章を「整える補助」として利用します

安全な枠組みの中で、
AIを一段だけ前に出します。
