# 第17回：本番データを「守る／捨てる」判断をする

―― すべてのデータは守る価値があるわけではない ――

DBを変えた。
Botも動いた。
でも次に来る不安は、これです。

> **「もし壊れたら、このデータどうする？」**

この回では、

* データを守ること
* データを捨てること

を **技術ではなく“判断”として実行**します。

---

## 📌 この回の目標

* 本番DBのバックアップを **実際に取る**
* バックアップから **実際に復元する**
* 「このデータは守る／捨てる」を言語化できる

**💡 この回の約束**

* 高度な仕組みは作らない
* 自動化しない
* 完璧な保全は目指さない

👉 **「今日の自分が扱える現実ライン」**を作ります。

---

## 🎯 完成イメージ

```
【Before】
DB壊れたら終わり…
→ 触れない
→ 機能追加できない

【After】
バックアップある
戻せる
捨ててもいい線引きがある
→ 判断できる
```

---

## 第1章：なぜ「全部守ろう」とすると詰むのか（10分）

### 1-1. よくある思考

* ユーザーデータは全部大事
* 消えたら信用を失う
* だから壊せない

結果：

> **何も変えられないDB**になる

---

### 1-2. 現実のデータは3種類に分かれる

この回では、データをこう分けます。

```
① 絶対に守りたい
② できれば守りたい
③ 消えてもいい
```

👉 **全部①は存在しない**

---

## 第2章：今のDBの「守る価値」を分類する（10分）

### 2-1. 実際に書き出す（紙 or メモ）

例：

| データ    | 守る？ |
| ------ | --- |
| ユーザーID | ①   |
| 気分記録   | ②   |
| 一時ログ   | ③   |

**理由は雑でOK**

---

### 2-2. この分類の使い道

* ①：必ずバックアップ
* ②：余裕があれば
* ③：壊れたら捨てる

👉 **バックアップ戦略が決まる**

---

## 第3章：バックアップを取る（15分）

### 3-1. SQLiteを丸ごとコピーする

```bash
cp data/bot.db data/bot_backup_$(date +%Y%m%d).db
```

**これだけでOK**

---

### 3-2. バックアップを確認する

```bash
ls data/
```

👉 **「ある」という事実が重要**

---

## 第4章：わざとDBを壊す（15分）

### 4-1. 危険だけどやる

```bash
rm data/bot.db
```

or

```bash
sqlite3 data/bot.db
DROP TABLE feelings;
```

---

### 4-2. Bot を起動する

```bash
pm2 restart discord-bot
pm2 logs discord-bot
```

**結果**

* DBエラー
* Botが止まる

👉 **ここで修正しない**

---

## 第5章：バックアップから復元する（15分）

### 5-1. バックアップを戻す

```bash
cp data/bot_backup_202602xx.db data/bot.db
```

---

### 5-2. 再起動

```bash
pm2 restart discord-bot
pm2 logs discord-bot
```

**確認**

* Botが起動する
* データが戻っている

👉 **「戻せた」体験が最大の学び**

---

## 第6章：復元できなかった場合の判断（10分）

### ケース：バックアップが古い

* 一部のデータが消える
* 最新分は戻らない

**この時の判断**

* 全部捨てる？
* 古い状態で再開？
* Botを一時停止？

👉 **正解はない**

---

## 第7章：この回で一番大事な線引き（10分）

### 7-1. 自分に聞く3つの質問

* このBotが止まると **誰が困る？**
* データが消えたら **本当に致命的？**
* 守るコストに **見合っている？**

---

### 7-2. この回の結論

> **守るべきなのはデータではなく、
> 判断できる状態**

---

## 第8章：この回でやらないこと

* 自動バックアップ
* 世代管理
* クラウドストレージ連携

👉 **それは必要になってから**

---

## ✅ この回のチェックリスト

* [ ] DBバックアップを取った
* [ ] DBを壊した
* [ ] バックアップから復元した
* [ ] データの価値を分類した
* [ ] 捨てる判断を肯定できた

---

## 🎓 この回で得たもの

* DBが「壊せるもの」になる
* 変更が怖くなくなる
* 本番対応の精神的余裕

> **守る準備があるから、
> 攻められる**

---

## 📝 次回予告

**第18回：Botをもう1体増やす判断をする**

次は、

* 同じサーバーで2Bot
* それとも分ける？
* pm2でどう管理する？

を **実際に増やして判断**します。