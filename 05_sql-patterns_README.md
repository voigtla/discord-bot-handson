# ç¬¬5å›ï¼šSQL ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šå‡ºã—ã‚„å®šå‹çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç™»éŒ²ï¼ˆç·Šæ€¥å¯¾ç­–ä¾‹ï¼‰

ãƒ¡ãƒ³ã‚¿ãƒ«ç³»ã‚µãƒ¼ãƒãƒ¼ã§ã¯ã€Œè¾›ã„ã¨ãã€ã«ç´ æ—©ãåå¿œã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚  
ä»Šå›ã¯ **å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** ã¨ **ç·Šæ€¥å¯¾å¿œ** ã®ä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã™ã€‚

---

## ğŸ“Œ ã“ã®å›ã®ç›®æ¨™

- å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç™»éŒ²ãƒ»å‘¼ã³å‡ºã—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åå¿œã™ã‚‹è‡ªå‹•å¿œç­”ã‚’å®Ÿè£…ã™ã‚‹
- ç·Šæ€¥æ™‚ã®å¯¾å¿œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œã‚‹

**ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆï¼š**
- å®Ÿéš›ã®ãƒ¡ãƒ³ã‚¿ãƒ«ç³»ã‚µãƒ¼ãƒãƒ¼ã§ä½¿ãˆã‚‹æ©Ÿèƒ½
- ç®¡ç†è€…ãŒç°¡å˜ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ãƒ»ç·¨é›†ã§ãã‚‹

---

## ğŸ¯ å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸

```
ã€å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ã€‘
ç®¡ç†è€…: /template add breathe "æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¸ã£ã¦... åã„ã¦..."
Bot: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ 'breathe' ã‚’ç™»éŒ²ã—ã¾ã—ãŸ

ãƒ¦ãƒ¼ã‚¶ãƒ¼: /template get breathe
Bot: æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¸ã£ã¦... åã„ã¦...

ã€è‡ªå‹•å¿œç­”æ©Ÿèƒ½ã€‘
ãƒ¦ãƒ¼ã‚¶ãƒ¼: è¾›ã„...
Bot: ğŸ¤— å¤§ä¸ˆå¤«ã§ã™ã‚ˆã€‚ä¸€ç·’ã«æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
     /template get breathe ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã€ç·Šæ€¥å¯¾å¿œã€‘
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /sos
Bot: ğŸ“ ç·Šæ€¥é€£çµ¡å…ˆ
     ãƒ»ã„ã®ã¡ã®é›»è©±: 0570-783-556
     ãƒ»ã“ã“ã‚ã®å¥åº·ç›¸è«‡: 0570-064-556
     ä¸€äººã§æŠ±ãˆè¾¼ã¾ãªã„ã§ãã ã•ã„ã­ã€‚
```

**ğŸ‘‰ Bot ãŒå®Ÿéš›ã«å½¹ç«‹ã¤å½¢ã«ãªã£ã¦ãã¾ã—ãŸ**

---

## ğŸ“š äº‹å‰æº–å‚™

### å¿…è¦ãªã‚‚ã®

- âœ… ç¬¬4å›ã¾ã§ã®å®Œæˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- âœ… Bot ãŒèµ·å‹•ã§ãã‚‹çŠ¶æ…‹

---

## ç¬¬1ç« ï¼šå®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆ10åˆ†ï¼‰

### 1-1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `index.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰ã®æº–å‚™ã‚’ã™ã‚‹å ´æ‰€ã§ã™ã€‚  
`index.js` ã®ä¸Šã®ã»ã†ã«ã‚ã‚‹ `const db = new Database(...)` ã¨ `db.exec(\` ãŒä¸¦ã‚“ã§ã„ã‚‹ã‚ãŸã‚Šã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã‚„åˆæœŸåŒ–ã®ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ã«ã“ã® **DBæº–å‚™ã®ã‹ãŸã¾ã‚Šã®ä¸­**ã«ç½®ãã¾ã™ã€‚

**å…·ä½“çš„ã«ã¯ï¼š**  
ã™ã§ã«ã‚ã‚‹ `db.exec(\`CREATE TABLE IF NOT EXISTS feelings ...\`)` ãªã©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆãƒ–ãƒ­ãƒƒã‚¯ã® **ä¸‹**ã«ã€  
æ–°ã—ãæ¬¡ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

**ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®å½¹å‰²ï¼š**  
å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã‚’ä¿å­˜ã—ã¾ã™ã€‚  
ç®¡ç†è€…ãŒè‡ªç”±ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ãƒ»ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

`index.js` ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–éƒ¨åˆ†ã«è¿½åŠ ï¼š

```javascript
// å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«
db.exec(`
  CREATE TABLE IF NOT EXISTS templates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key TEXT NOT NULL UNIQUE,
    content TEXT NOT NULL,
    category TEXT,
    created_by TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);
```

**ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼š**
- `key` â†’ å‘¼ã³å‡ºã—ç”¨ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¸€æ„ï¼‰
- `content` â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡
- `category` â†’ ã‚«ãƒ†ã‚´ãƒªï¼ˆbreathe, comfort, emergency ãªã©ï¼‰
- `created_by` â†’ ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID

---

### 1-2. åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `index.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ãŒçµ‚ã‚ã£ãŸå¾Œã€Bot ã‚’èµ·å‹•ã™ã‚‹å‰ã®å ´æ‰€ã§ã™ã€‚

å…·ä½“çš„ã«ã¯ï¼š
1. `db.exec(...)` ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã® **ä¸‹**
2. `const client = new Client(...)` ã§ Bot ã‚’ä½œæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã® **ä¸Š**

ã“ã®ä½ç½®ã«ã€æ¬¡ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

**ã“ã®é–¢æ•°ã®å½¹å‰²ï¼š**  
Bot ã‚’èµ·å‹•ã™ã‚‹ãŸã³ã«ã€åŸºæœ¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ·±å‘¼å¸ã‚¬ã‚¤ãƒ‰ã‚„ç·Šæ€¥é€£çµ¡å…ˆãªã©ï¼‰ã‚’è‡ªå‹•ã§ç™»éŒ²ã—ã¾ã™ã€‚  
`INSERT OR IGNORE` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ã¾ã›ã‚“ï¼ˆé‡è¤‡ã—ã¾ã›ã‚“ï¼‰ã€‚

Bot èµ·å‹•æ™‚ã«åŸºæœ¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è‡ªå‹•è¿½åŠ ã—ã¾ã™ï¼š

```javascript
// åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç™»éŒ²
function initializeTemplates() {
  const defaultTemplates = [
    {
      key: 'breathe',
      content: 'ğŸŒ¬ï¸ **æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†**\n\n4ç§’å¸ã£ã¦... 7ç§’æ­¢ã‚ã¦... 8ç§’ã‹ã‘ã¦åã...\n\nã‚†ã£ãã‚Š3å›ç¹°ã‚Šè¿”ã—ã¦ã¿ã¦ãã ã•ã„ã€‚',
      category: 'relaxation'
    },
    {
      key: 'comfort',
      content: 'ğŸ¤— **å¤§ä¸ˆå¤«ã§ã™**\n\nè¾›ã„æ°—æŒã¡ã€ã‚ˆãè©±ã—ã¦ãã‚Œã¾ã—ãŸã­ã€‚\nã‚ãªãŸã¯ä¸€äººã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã€‚\nå°‘ã—ãšã¤ã€ä¸€ç·’ã«ä¹—ã‚Šè¶Šãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
      category: 'comfort'
    },
    {
      key: 'emergency',
      content: 'ğŸ“ **ç·Šæ€¥é€£çµ¡å…ˆ**\n\nâ€¢ ã„ã®ã¡ã®é›»è©±: 0570-783-556 (24æ™‚é–“)\nâ€¢ ã“ã“ã‚ã®å¥åº·ç›¸è«‡: 0570-064-556\nâ€¢ SNSç›¸è«‡: https://www.mhlw.go.jp/mamorouyokokoro/\n\nä¸€äººã§æŠ±ãˆè¾¼ã¾ãªã„ã§ãã ã•ã„ã€‚',
      category: 'emergency'
    },
    {
      key: 'grounding',
      content: 'ğŸŒ **ã‚°ãƒ©ã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ³•**\n\nå‘¨ã‚Šã‚’è¦‹æ¸¡ã—ã¦ã€æ¬¡ã®ã‚‚ã®ã‚’æ¢ã—ã¦ã¿ã¦ãã ã•ã„ï¼š\nâ€¢ 5ã¤ã®è¦‹ãˆã‚‹ã‚‚ã®\nâ€¢ 4ã¤ã®è§¦ã‚Œã‚‹ã‚‚ã®\nâ€¢ 3ã¤ã®èã“ãˆã‚‹éŸ³\nâ€¢ 2ã¤ã®åŒ‚ã„\nâ€¢ 1ã¤ã®å‘³\n\nã€Œä»Šã“ã“ã€ã«æˆ»ã£ã¦ãã¾ã—ã‚‡ã†ã€‚',
      category: 'relaxation'
    }
  ];

  const insertStmt = db.prepare(`
    INSERT OR IGNORE INTO templates (key, content, category) 
    VALUES (?, ?, ?)
  `);

  defaultTemplates.forEach(template => {
    insertStmt.run(template.key, template.content, template.category);
  });

  console.log('åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæº–å‚™å®Œäº†');
}

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æº–å‚™å¾Œã«å®Ÿè¡Œ
initializeTemplates();
```

---

## ç¬¬2ç« ï¼š/template ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…ï¼ˆ20åˆ†ï¼‰

### 2-1. ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `register-commands.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
ã€ŒDiscordã«ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²ã™ã‚‹ã€ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚  
`register-commands.js` ã‚’é–‹ãã€`const commands = [` ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ã“ã®ç« ã§è¿½åŠ ã™ã‚‹ã®ã¯ã€åŸºæœ¬çš„ã«ã“ã® **é…åˆ—ã®ä¸­èº«**ã§ã™ï¼ˆæ—¢å­˜ã®é…åˆ—ã‚’ç·¨é›†ã—ã¾ã™ï¼‰ã€‚

**å…·ä½“çš„ã«ã¯ï¼š**  
ã™ã§ã«ã‚ã‚‹ `{ name: 'count', description: ... }` ãªã©ã®ã‚³ãƒãƒ³ãƒ‰å®šç¾©ã® **ä¸‹**ã«ã€  
ã‚«ãƒ³ãƒï¼ˆ`,`ï¼‰ã§åŒºåˆ‡ã£ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

**ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®å½¹å‰²ï¼š**  
`/template` ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰å½¢å¼ã§ã™ã€‚  
- `/template get [ã‚­ãƒ¼]` â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—
- `/template list` â†’ ä¸€è¦§è¡¨ç¤º
- `/template add` â†’ è¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
- `/template delete` â†’ å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

`register-commands.js` ã«è¿½åŠ ï¼š

```javascript
{
  name: 'template',
  description: 'å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç®¡ç†ã—ã¾ã™',
  options: [
    {
      name: 'get',
      description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—',
      type: 1, // SUB_COMMAND
      options: [
        {
          name: 'key',
          description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼',
          type: 3, // STRING
          required: true,
          autocomplete: true // ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆæœ‰åŠ¹åŒ–
        }
      ]
    },
    {
      name: 'list',
      description: 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§',
      type: 1
    },
    {
      name: 'add',
      description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰',
      type: 1,
      options: [
        {
          name: 'key',
          description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼',
          type: 3,
          required: true
        },
        {
          name: 'content',
          description: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹',
          type: 3,
          required: true
        },
        {
          name: 'category',
          description: 'ã‚«ãƒ†ã‚´ãƒª',
          type: 3,
          required: false
        }
      ]
    },
    {
      name: 'delete',
      description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰',
      type: 1,
      options: [
        {
          name: 'key',
          description: 'å‰Šé™¤ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼',
          type: 3,
          required: true
        }
      ]
    }
  ]
},
{
  name: 'sos',
  description: 'ç·Šæ€¥æ™‚ã®é€£çµ¡å…ˆã‚’è¡¨ç¤ºã—ã¾ã™'
}
```

**ã‚³ãƒãƒ³ãƒ‰å†ç™»éŒ²ï¼š**
```bash
node register-commands.js
```

---

### 2-2. /template ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†ã‚’å®Ÿè£…

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `index.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸç¬é–“ã«å‹•ãå‡¦ç†ã§ã™ã€‚  
`client.on('interactionCreate', async interaction => { ... })` ã®ä¸­ã§ã€  
`if (!interaction.isChatInputCommand()) return;` ã® **ä¸‹**ã«ã€  
ä»–ã® `if (interaction.commandName === '...')` ã¨ **åŒã˜ä¸¦ã³ï¼ˆåŒã˜æ·±ã•ï¼‰** ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

**å…·ä½“çš„ã«ã¯ï¼š**  
ã™ã§ã«ã‚ã‚‹ `/count` ã‚„ `/feeling` ã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã® **ä¸‹**ã«ã€  
æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

`index.js` ã«è¿½åŠ ï¼š

```javascript
client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;

  // ... æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç† ...

  // /template ã‚³ãƒãƒ³ãƒ‰
  if (interaction.commandName === 'template') {
    const subcommand = interaction.options.getSubcommand();

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—
    if (subcommand === 'get') {
      const key = interaction.options.getString('key');
      const stmt = db.prepare('SELECT content FROM templates WHERE key = ?');
      const row = stmt.get(key);

      if (row) {
        await interaction.reply(row.content);
      } else {
        await interaction.reply(`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚/template list ã§ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
      }
    }

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§
    if (subcommand === 'list') {
      const stmt = db.prepare('SELECT key, category FROM templates ORDER BY category, key');
      const templates = stmt.all();

      if (templates.length === 0) {
        await interaction.reply('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }

      // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æ•´ç†
      const grouped = {};
      templates.forEach(t => {
        const cat = t.category || 'ãã®ä»–';
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(t.key);
      });

      let message = '**ğŸ“ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**\n\n';
      for (const [category, keys] of Object.entries(grouped)) {
        message += `**${category}**\n`;
        keys.forEach(key => {
          message += `â€¢ \`${key}\`\n`;
        });
        message += '\n';
      }
      message += 'ä½¿ã„æ–¹: `/template get <ã‚­ãƒ¼>`';

      await interaction.reply(message);
    }

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
    if (subcommand === 'add') {
      // ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯
      if (!interaction.member.permissions.has('ManageMessages')) {
        await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
        return;
      }

      const key = interaction.options.getString('key');
      const content = interaction.options.getString('content');
      const category = interaction.options.getString('category') || 'ãã®ä»–';
      const createdBy = interaction.user.id;

      try {
        const stmt = db.prepare(`
          INSERT INTO templates (key, content, category, created_by) 
          VALUES (?, ?, ?, ?)
        `);
        stmt.run(key, content, category, createdBy);

        await interaction.reply(`âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚`);
      } catch (error) {
        if (error.message.includes('UNIQUE')) {
          await interaction.reply({ 
            content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚`, 
            ephemeral: true 
          });
        } else {
          await interaction.reply({ content: 'âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', ephemeral: true });
        }
      }
    }

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
    if (subcommand === 'delete') {
      if (!interaction.member.permissions.has('ManageMessages')) {
        await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
        return;
      }

      const key = interaction.options.getString('key');
      const stmt = db.prepare('DELETE FROM templates WHERE key = ?');
      const result = stmt.run(key);

      if (result.changes > 0) {
        await interaction.reply(`âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      } else {
        await interaction.reply({ content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
      }
    }
  }

  // /sos ã‚³ãƒãƒ³ãƒ‰
  if (interaction.commandName === 'sos') {
    const stmt = db.prepare('SELECT content FROM templates WHERE key = ?');
    const row = stmt.get('emergency');

    if (row) {
      await interaction.reply(row.content);
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      await interaction.reply('ğŸ“ ç·Šæ€¥é€£çµ¡å…ˆ\n\nâ€¢ ã„ã®ã¡ã®é›»è©±: 0570-783-556 (24æ™‚é–“)\nâ€¢ ã“ã“ã‚ã®å¥åº·ç›¸è«‡: 0570-064-556\n\nä¸€äººã§æŠ±ãˆè¾¼ã¾ãªã„ã§ãã ã•ã„ã€‚');
    }
  }
});
```

---

### 2-3. ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã®å®Ÿè£…

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `index.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
âš ï¸ **æ³¨æ„ï¼š** ã“ã“ã¯ `/template` ã‚’å®Ÿè¡Œã—ãŸã¨ãã®å‡¦ç†ã§ã¯ãªãã€**å…¥åŠ›ä¸­ã«å€™è£œã‚’è¿”ã™ãŸã‚**ã®å‡¦ç†ã§ã™ã€‚  
ãã®ãŸã‚ã€`interaction.isChatInputCommand()` ã®ä¸­ï¼ˆ/template ã®å‡¦ç†ãƒ–ãƒ­ãƒƒã‚¯ã®ä¸­ï¼‰ã«ã¯æ›¸ãã¾ã›ã‚“ã€‚

**å…·ä½“çš„ã«ã¯ï¼š**  
`index.js` ã‚’é–‹ãã€ã™ã§ã«ã‚ã‚‹ `client.on('interactionCreate', async interaction => { ... })` ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ãã® **ãƒ–ãƒ­ãƒƒã‚¯ã®å¤–å´ï¼ˆåŒã˜éšå±¤ï¼‰**ã«ã€æ¬¡ã®ã€Œã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç”¨ã® interactionCreateã€ã‚’ **æ–°ã—ã„ãƒ–ãƒ­ãƒƒã‚¯ã¨ã—ã¦è¿½åŠ **ã—ã¾ã™ã€‚

**ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š**
```javascript
// æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;
  // ... ã‚³ãƒãƒ³ãƒ‰å‡¦ç† ...
});

// ã“ã“ã«æ–°ã—ãè¿½åŠ  â†“
client.on('interactionCreate', async interaction => {
  if (!interaction.isAutocomplete()) return;
  // ... ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆå‡¦ç† ...
});
```

`index.js` ã‚’é–‹ãã€ã™ã§ã«ã‚ã‚‹ `client.on('interactionCreate', async interaction => { ... })` ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ãã® **è¿‘ãï¼ˆåŒã˜éšå±¤ï¼‰**ã«ã€æ¬¡ã®ã€Œã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç”¨ã® interactionCreateã€ã‚’ **åˆ¥ãƒ–ãƒ­ãƒƒã‚¯ã¨ã—ã¦æ–°ã—ãè¿½åŠ **ã—ã¾ã™ã€‚

```js
// ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©
client.on('interactionCreate', async interaction => {
  if (!interaction.isAutocomplete()) return;

  if (interaction.commandName === 'template') {
    const focusedValue = interaction.options.getFocused();
    const stmt = db.prepare('SELECT key FROM templates WHERE key LIKE ? LIMIT 25');
    const choices = stmt.all(`%${focusedValue}%`);

    await interaction.respond(
      choices.map(choice => ({ name: choice.key, value: choice.key }))
    );
  }
});
````

---

### 2-4. å‹•ä½œç¢ºèª

```bash
node index.js
```

Discord ã§è©¦ã—ã¦ãã ã•ã„ï¼š

```
/template list
â†’ Bot: ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹

/template get breathe
â†’ Bot: æ·±å‘¼å¸ã®ã‚¬ã‚¤ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹

/sos
â†’ Bot: ç·Šæ€¥é€£çµ¡å…ˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

**âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼**

---

## ç¬¬3ç« ï¼šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œã‚·ã‚¹ãƒ†ãƒ ï¼ˆ20åˆ†ï¼‰

### 3-1. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

ã“ã“ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰ã®æº–å‚™ã‚’ã™ã‚‹å ´æ‰€ã§ã™ã€‚  
`index.js` ã®ä¸Šã®ã»ã†ã«ã‚ã‚‹ `const db = new Database(...)` ã¨ `db.exec(` ãŒä¸¦ã‚“ã§ã„ã‚‹ã‚ãŸã‚Šã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã‚„åˆæœŸåŒ–ã®ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ã«ã“ã® **DBæº–å‚™ã®ã‹ãŸã¾ã‚Šã®ä¸­**ã«ç½®ãã¾ã™ã€‚


ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«è‡ªå‹•åå¿œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚Šã¾ã™ï¼š

```javascript
// ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œç”¨ãƒ†ãƒ¼ãƒ–ãƒ«
db.exec(`
  CREATE TABLE IF NOT EXISTS keyword_responses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    keyword TEXT NOT NULL,
    template_key TEXT NOT NULL,
    priority INTEGER DEFAULT 0,
    enabled INTEGER DEFAULT 1,
    FOREIGN KEY (template_key) REFERENCES templates(key)
  )
`);

// åˆæœŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç™»éŒ²
function initializeKeywords() {
  const defaultKeywords = [
    { keyword: 'è¾›ã„', template_key: 'comfort', priority: 10 },
    { keyword: 'ã¤ã‚‰ã„', template_key: 'comfort', priority: 10 },
    { keyword: 'è‹¦ã—ã„', template_key: 'breathe', priority: 8 },
    { keyword: 'æ¯è‹¦ã—ã„', template_key: 'breathe', priority: 10 },
    { keyword: 'ãƒ‘ãƒ‹ãƒƒã‚¯', template_key: 'grounding', priority: 10 },
    { keyword: 'æ­»ã«ãŸã„', template_key: 'emergency', priority: 100 },
    { keyword: 'æ¶ˆãˆãŸã„', template_key: 'emergency', priority: 100 }
  ];

  const insertStmt = db.prepare(`
    INSERT OR IGNORE INTO keyword_responses (keyword, template_key, priority) 
    VALUES (?, ?, ?)
  `);

  defaultKeywords.forEach(kw => {
    insertStmt.run(kw.keyword, kw.template_key, kw.priority);
  });

  console.log('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œæº–å‚™å®Œäº†');
}

initializeKeywords();
```

---

### 3-2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç›£è¦–ã®å®Ÿè£…

**ã“ã“ã§ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** `index.js`

**ã©ã“ã«æ›¸ãã‹ï¼š**  
âš ï¸ **æ³¨æ„ï¼š** ã“ã“ã§ã¯ã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªã **é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã¾ã¾é€ä¿¡ã—ãŸæ–‡ï¼‰ã«åå¿œã—ã¾ã™ã€‚  
ãã®ãŸã‚ã€`client.on('interactionCreate', ...)` ã®ä¸­ã«ã¯æ›¸ãã¾ã›ã‚“ï¼ˆåˆ¥ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ï¼‰ã€‚

**å…·ä½“çš„ã«ã¯ï¼š**  
`index.js` ã‚’é–‹ãã€ã¾ãš `client.on('interactionCreate', ...)` ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚  
ãã® **ãƒ–ãƒ­ãƒƒã‚¯ã®å¤–å´ï¼ˆåŒã˜éšå±¤ï¼‰**ã«ã€æ¬¡ã® `client.on('messageCreate', ...)` ã‚’ **æ–°ã—ãè¿½åŠ **ã—ã¾ã™ã€‚

**ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š**
```javascript
// ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ï¼ˆæ—¢å­˜ï¼‰
client.on('interactionCreate', async interaction => {
  // ... ã‚³ãƒãƒ³ãƒ‰å‡¦ç† ...
});

// ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ˆæ—¢å­˜ï¼‰
client.on('interactionCreate', async interaction => {
  if (!interaction.isAutocomplete()) return;
  // ... ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆå‡¦ç† ...
});

// ã“ã“ã«æ–°ã—ãè¿½åŠ  â†“
client.on('messageCreate', async message => {
  // ... ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç›£è¦–å‡¦ç† ...
});
```

**ã“ã®å‡¦ç†ã®å½¹å‰²ï¼š**  
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ™®é€šã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ãŸã¨ãï¼ˆã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªãï¼‰ã€  
ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€Œè¾›ã„ã€ã€Œè‹¦ã—ã„ã€ãªã©ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰ã€  
è‡ªå‹•ã§åŠ±ã¾ã—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªã **é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã¾ã¾é€ä¿¡ã—ãŸæ–‡ï¼‰ã«åå¿œã—ã¾ã™ã€‚  
ãã®ãŸã‚ã€`client.on('interactionCreate', ...)` ã®ä¸­ã«ã¯æ›¸ãã¾ã›ã‚“ï¼ˆåˆ¥ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ï¼‰ã€‚

`index.js` ã‚’é–‹ãã€ã¾ãš `client.on('interactionCreate', ...)` ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚  
ãã® **ãƒ–ãƒ­ãƒƒã‚¯ã®å¤–å´ï¼ˆåŒã˜éšå±¤ï¼‰**ã«ã€æ¬¡ã® `client.on('messageCreate', ...)` ã‚’ **æ–°ã—ãè¿½åŠ **ã—ã¾ã™ã€‚

```js
// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©
client.on('messageCreate', async message => {
  // Botè‡ªèº«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–
  if (message.author.bot) return;

  // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–
  if (message.system) return;

  const content = message.content.toLowerCase();

  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
  const stmt = db.prepare(`
    SELECT kr.keyword, kr.template_key, kr.priority, t.content 
    FROM keyword_responses kr
    JOIN templates t ON kr.template_key = t.key
    WHERE kr.enabled = 1
    AND LOWER(?) LIKE '%' || LOWER(kr.keyword) || '%'
    ORDER BY kr.priority DESC, kr.keyword DESC
    LIMIT 1
  `);
  const match = stmt.get(content);

  if (match) {
    // å„ªå…ˆåº¦ãŒé«˜ã„ï¼ˆç·Šæ€¥ï¼‰å ´åˆã¯å³åº§ã«åå¿œ
    if (match.priority >= 100) {
      await message.reply(match.content);
      return;
    }

    // å„ªå…ˆåº¦ãŒä¸­ç¨‹åº¦ã®å ´åˆã¯æ§ãˆã‚ã«åå¿œ
    if (match.priority >= 10) {
      await message.reply({
        content: `${match.content}\n\nå¿…è¦ã§ã‚ã‚Œã° \`/sos\` ã§ç·Šæ€¥é€£çµ¡å…ˆã‚’ç¢ºèªã§ãã¾ã™ã€‚`,
        allowedMentions: { repliedUser: false } // ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—ãªã„
      });
      return;
    }

    // ä½å„ªå…ˆåº¦ã¯ææ¡ˆã®ã¿
    await message.reply({
      content: `ğŸ’¡ \`/template get ${match.template_key}\` ãŒå½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚`,
      allowedMentions: { repliedUser: false }
    });
  }
});
```

---

### 3-3. å‹•ä½œç¢ºèª

```bash
node index.js
```

Discord ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§è©¦ã—ã¦ãã ã•ã„ï¼š

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ãªã‚“ã‹è¾›ã„...
Bot: ğŸ¤— å¤§ä¸ˆå¤«ã§ã™
     è¾›ã„æ°—æŒã¡ã€ã‚ˆãè©±ã—ã¦ãã‚Œã¾ã—ãŸã­ã€‚
     ...
     å¿…è¦ã§ã‚ã‚Œã° `/sos` ã§ç·Šæ€¥é€£çµ¡å…ˆã‚’ç¢ºèªã§ãã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼: æ¯è‹¦ã—ã„
Bot: ğŸŒ¬ï¸ **æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†**
     ...
```

**âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åå¿œã™ã‚Œã°æˆåŠŸã§ã™ï¼**

---

## ç¬¬4ç« ï¼šç®¡ç†è€…å‘ã‘ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã‚³ãƒãƒ³ãƒ‰ï¼ˆ15åˆ†ï¼‰

### 4-1. /keyword ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²

`register-commands.js` ã«è¿½åŠ ï¼š

```javascript
{
  name: 'keyword',
  description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œã‚’ç®¡ç†ã—ã¾ã™ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰',
  options: [
    {
      name: 'add',
      description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ',
      type: 1,
      options: [
        {
          name: 'keyword',
          description: 'åå¿œã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
          type: 3,
          required: true
        },
        {
          name: 'template',
          description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚­ãƒ¼',
          type: 3,
          required: true
        },
        {
          name: 'priority',
          description: 'å„ªå…ˆåº¦ï¼ˆ1-100ã€é«˜ã„ã»ã©å„ªå…ˆï¼‰',
          type: 4, // INTEGER
          required: false
        }
      ]
    },
    {
      name: 'list',
      description: 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§',
      type: 1
    },
    {
      name: 'delete',
      description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤',
      type: 1,
      options: [
        {
          name: 'id',
          description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID',
          type: 4,
          required: true
        }
      ]
    }
  ]
}
```

**ã‚³ãƒãƒ³ãƒ‰å†ç™»éŒ²ï¼š**
```bash
node register-commands.js
```

---

### 4-2. /keyword ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†

ã“ã“ã¯ **ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã®å‡¦ç†**ãªã®ã§ã€`index.js` ã®  
`client.on('interactionCreate', async interaction => { ... })` ã®ä¸­ã«å…¥ã‚Œã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã€`if (!interaction.isChatInputCommand()) return;` ã® **ä¸‹**ã§ã€  
ä»–ã® `if (interaction.commandName === '...') { ... }` ã¨ **åŒã˜ä¸¦ã³ï¼ˆåŒã˜æ·±ã•ï¼‰**ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

```js
if (interaction.commandName === 'keyword') {
  // ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯
  if (!interaction.member.permissions.has('ManageMessages')) {
    await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
    return;
  }

  const subcommand = interaction.options.getSubcommand();

  if (subcommand === 'add') {
    const keyword = interaction.options.getString('keyword');
    const templateKey = interaction.options.getString('template');
    const priority = interaction.options.getInteger('priority') || 5;

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å­˜åœ¨ç¢ºèª
    const checkStmt = db.prepare('SELECT key FROM templates WHERE key = ?');
    if (!checkStmt.get(templateKey)) {
      await interaction.reply({ content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${templateKey}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
      return;
    }

    const stmt = db.prepare(`
      INSERT INTO keyword_responses (keyword, template_key, priority) 
      VALUES (?, ?, ?)
    `);
    stmt.run(keyword, templateKey, priority);

    await interaction.reply(`âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ '${keyword}' ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ˆå„ªå…ˆåº¦: ${priority}ï¼‰`);
  }

  if (subcommand === 'list') {
    const stmt = db.prepare(`
      SELECT id, keyword, template_key, priority, enabled 
      FROM keyword_responses 
      ORDER BY priority DESC, keyword
    `);
    const keywords = stmt.all();

    if (keywords.length === 0) {
      await interaction.reply('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }

    let message = '**ğŸ”‘ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**\n\n';
    keywords.forEach(kw => {
      const status = kw.enabled ? 'âœ…' : 'âŒ';
      message += `${status} ID:${kw.id} | ã€Œ${kw.keyword}ã€ â†’ \`${kw.template_key}\` (å„ªå…ˆåº¦: ${kw.priority})\n`;
    });

    await interaction.reply(message);
  }

  if (subcommand === 'delete') {
    const id = interaction.options.getInteger('id');
    const stmt = db.prepare('DELETE FROM keyword_responses WHERE id = ?');
    const result = stmt.run(id);

    if (result.changes > 0) {
      await interaction.reply(`âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID ${id} ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
    } else {
      await interaction.reply({ content: `âŒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID ${id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
    }
  }
}
```

---

## ç¬¬5ç« ï¼šGit ã§è¨˜éŒ²ï¼ˆ5åˆ†ï¼‰

```bash
git add .
git commit -m "ç¬¬5å›: å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸+ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œå®Ÿè£…"
git push
```

---

## âœ… ã“ã®å›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `templates` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã§ããŸ
- [ ] åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç™»éŒ²ã•ã‚ŒãŸ
- [ ] `/template` ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã—ãŸ
- [ ] `/sos` ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã—ãŸ
- [ ] ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«è‡ªå‹•åå¿œã—ãŸ
- [ ] ç®¡ç†è€…ãŒæ–°ã—ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ããŸ
- [ ] Git ã«ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ã§ããŸ

---

## ğŸ” ä»Šæ—¥è¦šãˆã‚‹ã“ã¨

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 

- å†åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç®¡ç†
- ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ã«ã‚ˆã‚‹æ•´ç†
- ç®¡ç†è€…ã«ã‚ˆã‚‹å‹•çš„ãªè¿½åŠ ãƒ»å‰Šé™¤

### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œ

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç›£è¦–
- å„ªå…ˆåº¦ã«ã‚ˆã‚‹åå¿œã®åˆ¶å¾¡
- ç·Šæ€¥å¯¾å¿œã®è‡ªå‹•åŒ–

### å®Ÿç”¨çš„ãªè¨­è¨ˆ

- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆFOREIGN KEYï¼‰
- å„ªå…ˆåº¦ã‚·ã‚¹ãƒ†ãƒ 
- æœ‰åŠ¹/ç„¡åŠ¹ãƒ•ãƒ©ã‚°

---

## âš ï¸ ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åå¿œã—ãªã„

**åŸå› ï¼š** ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„

**å¯¾å‡¦æ³•ï¼š**
1. `client.on('messageCreate', ...)` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. Bot ã‚’å†èµ·å‹•

---

### ç®¡ç†è€…ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆãªã„

ã“ã“ã§è¿½åŠ ã™ã‚‹å‡¦ç†ã¯ã€**ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸç¬é–“**ã«å‹•ãã‚‚ã®ã§ã™ã€‚  
`index.js` ã‚’é–‹ãã€`client.on('interactionCreate', ...)` ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚  
ãã®ä¸­ã® `if (!interaction.isChatInputCommand()) return;` ãŒã‚ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãŒå¯¾è±¡ã§ã™ã€‚  
ã“ã®ç« ã®ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ã«ãã® **ãƒ–ãƒ­ãƒƒã‚¯ã®ä¸­**ï¼ˆä»–ã® `if (interaction.commandName === ...)` ã¨åŒã˜ä¸¦ã³ï¼‰ã«å…¥ã‚Œã¾ã™ã€‚


**åŸå› ï¼š** æ¨©é™ãŒãªã„

**å¯¾å‡¦æ³•ï¼š**
- ã‚µãƒ¼ãƒãƒ¼ã§ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç®¡ç†ã€æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª

---

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

**åŸå› ï¼š** åˆæœŸåŒ–é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**å¯¾å‡¦æ³•ï¼š**
1. `initializeTemplates()` ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. Bot ã‚’å†èµ·å‹•
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

### å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„

```sql
FOREIGN KEY (template_key) REFERENCES templates(key)
```

**æ„å‘³ï¼š**
- `template_key` ã¯ `templates` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `key` ã«å­˜åœ¨ã™ã‚‹å€¤ã®ã¿
- å­˜åœ¨ã—ãªã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ç™»éŒ²ã§ããªã„

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãŒä¿ãŸã‚Œã‚‹
- å‰Šé™¤æ™‚ã®é€£é–å‡¦ç†ã‚‚å¯èƒ½

---

### å„ªå…ˆåº¦ã‚·ã‚¹ãƒ†ãƒ 

- 100ä»¥ä¸Š â†’ ç·Šæ€¥ï¼ˆå³åº§ã«åå¿œï¼‰
- 10-99 â†’ é‡è¦ï¼ˆæ§ãˆã‚ã«åå¿œï¼‰
- 1-9 â†’ ææ¡ˆï¼ˆãƒªãƒ³ã‚¯ã®ã¿ï¼‰

**ğŸ‘‰ æŸ”è»Ÿãªå¯¾å¿œãŒå¯èƒ½**

---

## ğŸ“ ç™ºå±•èª²é¡Œï¼ˆè‡ªç¿’ç”¨ï¼‰

1. **æ™‚é–“å¸¯ã«ã‚ˆã‚‹åå¿œåˆ¶å¾¡**
   - æ·±å¤œã¯å„ªå…ˆåº¦ã‚’ä¸Šã’ã‚‹

2. **ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ©Ÿèƒ½**
   - åŒã˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«é€£ç¶šåå¿œã—ãªã„

3. **çµ±è¨ˆæ©Ÿèƒ½**
   - ã©ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå¤šãä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹

---

## æ¬¡å›äºˆå‘Š

### ç¬¬6å›ï¼šAI ã‚’åˆ©ç”¨ã™ã‚‹ï¼ˆGemini API ç™»éŒ²ï¼‰+ ã‚µãƒ³ãƒ—ãƒ«ã®å®Ÿè¡Œ

ã¤ã„ã« AI ã‚’å°å…¥ã—ã¾ã™ï¼š
- Gemini API ã®ç™»éŒ²
- AI ã¨ã®ä¼šè©±æ©Ÿèƒ½
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç†è§£ã—ãŸå¿œç­”

**ğŸ‘‰ Bot ãŒæœ¬å½“ã«ã€Œä¼šè©±ã€ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼**
---

## ğŸ“¦ ç¬¬5å›ã®å®Œæˆç‰ˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
git_practice/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env
â”œâ”€â”€ .env.example
â”œâ”€â”€ package.json
â”œâ”€â”€ index.js
â”œâ”€â”€ register-commands.js
â””â”€â”€ bot.dbï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
```

---

### index.js
```
require('dotenv').config();
const { Client, GatewayIntentBits } = require('discord.js');
const Database = require('better-sqlite3');

const db = new Database('bot.db');

// æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«
db.exec(`
  CREATE TABLE IF NOT EXISTS messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);

db.exec(`
  CREATE TABLE IF NOT EXISTS feelings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    feeling TEXT NOT NULL,
    note TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);

// å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«
db.exec(`
  CREATE TABLE IF NOT EXISTS templates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key TEXT NOT NULL UNIQUE,
    content TEXT NOT NULL,
    category TEXT,
    created_by TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);

// ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œç”¨ãƒ†ãƒ¼ãƒ–ãƒ«
db.exec(`
  CREATE TABLE IF NOT EXISTS keyword_responses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    keyword TEXT NOT NULL,
    template_key TEXT NOT NULL,
    priority INTEGER DEFAULT 0,
    enabled INTEGER DEFAULT 1,
    FOREIGN KEY (template_key) REFERENCES templates(key)
  )
`);

console.log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æº–å‚™å®Œäº†');

// åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç™»éŒ²
function initializeTemplates() {
  const defaultTemplates = [
    {
      key: 'breathe',
      content: 'ğŸŒ¬ï¸ **æ·±å‘¼å¸ã—ã¦ã¿ã¾ã—ã‚‡ã†**\n\n4ç§’å¸ã£ã¦... 7ç§’æ­¢ã‚ã¦... 8ç§’ã‹ã‘ã¦åã...\n\nã‚†ã£ãã‚Š3å›ç¹°ã‚Šè¿”ã—ã¦ã¿ã¦ãã ã•ã„ã€‚',
      category: 'relaxation'
    },
    {
      key: 'comfort',
      content: 'ğŸ¤— **å¤§ä¸ˆå¤«ã§ã™**\n\nè¾›ã„æ°—æŒã¡ã€ã‚ˆãè©±ã—ã¦ãã‚Œã¾ã—ãŸã­ã€‚\nã‚ãªãŸã¯ä¸€äººã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã€‚\nå°‘ã—ãšã¤ã€ä¸€ç·’ã«ä¹—ã‚Šè¶Šãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
      category: 'comfort'
    },
    {
      key: 'emergency',
      content: 'ğŸ“ **ç·Šæ€¥é€£çµ¡å…ˆ**\n\nâ€¢ ã„ã®ã¡ã®é›»è©±: 0570-783-556 (24æ™‚é–“)\nâ€¢ ã“ã“ã‚ã®å¥åº·ç›¸è«‡: 0570-064-556\nâ€¢ SNSç›¸è«‡: https://www.mhlw.go.jp/mamorouyokokoro/\n\nä¸€äººã§æŠ±ãˆè¾¼ã¾ãªã„ã§ãã ã•ã„ã€‚',
      category: 'emergency'
    },
    {
      key: 'grounding',
      content: 'ğŸŒ **ã‚°ãƒ©ã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ³•**\n\nå‘¨ã‚Šã‚’è¦‹æ¸¡ã—ã¦ã€æ¬¡ã®ã‚‚ã®ã‚’æ¢ã—ã¦ã¿ã¦ãã ã•ã„ï¼š\nâ€¢ 5ã¤ã®è¦‹ãˆã‚‹ã‚‚ã®\nâ€¢ 4ã¤ã®è§¦ã‚Œã‚‹ã‚‚ã®\nâ€¢ 3ã¤ã®èã“ãˆã‚‹éŸ³\nâ€¢ 2ã¤ã®åŒ‚ã„\nâ€¢ 1ã¤ã®å‘³\n\nã€Œä»Šã“ã“ã€ã«æˆ»ã£ã¦ãã¾ã—ã‚‡ã†ã€‚',
      category: 'relaxation'
    }
  ];

  const insertStmt = db.prepare(`
    INSERT OR IGNORE INTO templates (key, content, category) 
    VALUES (?, ?, ?)
  `);

  defaultTemplates.forEach(template => {
    insertStmt.run(template.key, template.content, template.category);
  });

  console.log('åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæº–å‚™å®Œäº†');
}

// åˆæœŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç™»éŒ²
function initializeKeywords() {
  const defaultKeywords = [
    { keyword: 'è¾›ã„', template_key: 'comfort', priority: 10 },
    { keyword: 'ã¤ã‚‰ã„', template_key: 'comfort', priority: 10 },
    { keyword: 'è‹¦ã—ã„', template_key: 'breathe', priority: 8 },
    { keyword: 'æ¯è‹¦ã—ã„', template_key: 'breathe', priority: 10 },
    { keyword: 'ãƒ‘ãƒ‹ãƒƒã‚¯', template_key: 'grounding', priority: 10 },
    { keyword: 'æ­»ã«ãŸã„', template_key: 'emergency', priority: 100 },
    { keyword: 'æ¶ˆãˆãŸã„', template_key: 'emergency', priority: 100 }
  ];

  const insertStmt = db.prepare(`
    INSERT OR IGNORE INTO keyword_responses (keyword, template_key, priority) 
    VALUES (?, ?, ?)
  `);

  defaultKeywords.forEach(kw => {
    insertStmt.run(kw.keyword, kw.template_key, kw.priority);
  });

  console.log('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œæº–å‚™å®Œäº†');
}

initializeTemplates();
initializeKeywords();

// æ™‚é–“å·®ã‚’äººé–“ã«èª­ã¿ã‚„ã™ã„å½¢å¼ã§è¿”ã™
function getTimeDiff(timestamp) {
  const now = new Date();
  const past = new Date(timestamp);
  const diffMs = now - past;
  const diffMinutes = Math.floor(diffMs / 60000);

  if (diffMinutes < 1) return 'ä»Š';
  if (diffMinutes < 60) return `${diffMinutes}åˆ†å‰`;

  const diffHours = Math.floor(diffMinutes / 60);
  if (diffHours < 24) return `${diffHours}æ™‚é–“å‰`;

  const diffDays = Math.floor(diffHours / 24);
  return `${diffDays}æ—¥å‰`;
}

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent
  ]
});

client.once('ready', () => {
  console.log(`${client.user.tag} ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼`);
});

client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;

  if (interaction.commandName === 'hello') {
    await interaction.reply('ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã† ğŸ˜Š');
  }

  if (interaction.commandName === 'save') {
    const message = interaction.options.getString('message');
    const userId = interaction.user.id;
    const stmt = db.prepare('INSERT INTO messages (user_id, content) VALUES (?, ?)');
    stmt.run(userId, message);
    await interaction.reply('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ ğŸ“');
  }

  if (interaction.commandName === 'read') {
    const userId = interaction.user.id;
    const stmt = db.prepare('SELECT content FROM messages WHERE user_id = ? ORDER BY created_at DESC LIMIT 1');
    const row = stmt.get(userId);
    if (row) {
      await interaction.reply(`è¨˜éŒ²ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${row.content}`);
    } else {
      await interaction.reply('ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
  }

  if (interaction.commandName === 'feeling') {
    const userId = interaction.user.id;
    const feeling = interaction.options.getString('mood');
    const note = interaction.options.getString('note') || null;
    const stmt = db.prepare('INSERT INTO feelings (user_id, feeling, note) VALUES (?, ?, ?)');
    stmt.run(userId, feeling, note);
    const countStmt = db.prepare('SELECT COUNT(*) as count FROM feelings WHERE user_id = ?');
    const { count } = countStmt.get(userId);
    const emoji = { great: 'ğŸ˜Š', good: 'ğŸ™‚', okay: 'ğŸ˜', down: 'ğŸ˜”', bad: 'ğŸ˜¢' }[feeling] || 'ğŸ“';
    let message = `ä»Šæ—¥ã®æ°—åˆ†ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ ${emoji} (ç´¯è¨ˆ: ${count}å›ç›®)`;
    if (note) message += `\nãƒ¡ãƒ¢: ${note}`;
    await interaction.reply(message);
  }

  if (interaction.commandName === 'count') {
    const userId = interaction.user.id;
    const totalStmt = db.prepare('SELECT COUNT(*) as count FROM feelings WHERE user_id = ?');
    const { count: totalCount } = totalStmt.get(userId);
    if (totalCount === 0) {
      await interaction.reply('ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚/feeling ã§æ°—åˆ†ã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼');
      return;
    }
    const todayStmt = db.prepare(`SELECT COUNT(*) as count FROM feelings WHERE user_id = ? AND DATE(created_at) = DATE('now', 'localtime')`);
    const { count: todayCount } = todayStmt.get(userId);
    const weekStmt = db.prepare(`SELECT COUNT(*) as count FROM feelings WHERE user_id = ? AND DATE(created_at) >= DATE('now', '-7 days', 'localtime')`);
    const { count: weekCount } = weekStmt.get(userId);
    const feelingStmt = db.prepare(`SELECT feeling, COUNT(*) as count FROM feelings WHERE user_id = ? GROUP BY feeling`);
    const feelingCounts = feelingStmt.all(userId);
    const latestStmt = db.prepare(`SELECT feeling, note, created_at FROM feelings WHERE user_id = ? ORDER BY created_at DESC LIMIT 1`);
    const latest = latestStmt.get(userId);
    const timeDiff = getTimeDiff(latest.created_at);
    const emojiMap = { great: 'ğŸ˜Š', good: 'ğŸ™‚', okay: 'ğŸ˜', down: 'ğŸ˜”', bad: 'ğŸ˜¢' };
    let message = '**ã‚ãªãŸã®è¨˜éŒ²**\n';
    message += `ğŸ“Š ç·è¨˜éŒ²æ•°: ${totalCount}å›\nğŸ“… ä»Šæ—¥ã®è¨˜éŒ²: ${todayCount}å›\nğŸ“† éå»7æ—¥é–“: ${weekCount}å›\n\n**æ°—åˆ†ã®å†…è¨³**\n`;
    feelingCounts.forEach(({ feeling, count }) => {
      const emoji = emojiMap[feeling] || 'ğŸ“';
      const percentage = Math.round((count / totalCount) * 100);
      message += `${emoji} ${feeling}: ${count}å› (${percentage}%)\n`;
    });
    message += `\næœ€çµ‚è¨˜éŒ²: ${latest.feeling} (${timeDiff})`;
    if (latest.note) message += `\nãƒ¡ãƒ¢: ${latest.note}`;
    await interaction.reply(message);
  }

  if (interaction.commandName === 'template') {
    const subcommand = interaction.options.getSubcommand();
    if (subcommand === 'get') {
      const key = interaction.options.getString('key');
      const stmt = db.prepare('SELECT content FROM templates WHERE key = ?');
      const row = stmt.get(key);
      if (row) {
        await interaction.reply(row.content);
      } else {
        await interaction.reply(`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚/template list ã§ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
      }
    }
    if (subcommand === 'list') {
      const stmt = db.prepare('SELECT key, category FROM templates ORDER BY category, key');
      const templates = stmt.all();
      if (templates.length === 0) {
        await interaction.reply('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }
      const grouped = {};
      templates.forEach(t => {
        const cat = t.category || 'ãã®ä»–';
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(t.key);
      });
      let message = '**ğŸ“ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**\n\n';
      for (const [category, keys] of Object.entries(grouped)) {
        message += `**${category}**\n`;
        keys.forEach(key => { message += `â€¢ \`${key}\`\n`; });
        message += '\n';
      }
      message += 'ä½¿ã„æ–¹: `/template get <ã‚­ãƒ¼>`';
      await interaction.reply(message);
    }
    if (subcommand === 'add') {
      if (!interaction.member.permissions.has('ManageMessages')) {
        await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
        return;
      }
      const key = interaction.options.getString('key');
      const content = interaction.options.getString('content');
      const category = interaction.options.getString('category') || 'ãã®ä»–';
      const createdBy = interaction.user.id;
      try {
        const stmt = db.prepare(`INSERT INTO templates (key, content, category, created_by) VALUES (?, ?, ?, ?)`);
        stmt.run(key, content, category, createdBy);
        await interaction.reply(`âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚`);
      } catch (error) {
        if (error.message.includes('UNIQUE')) {
          await interaction.reply({ content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚`, ephemeral: true });
        } else {
          await interaction.reply({ content: 'âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', ephemeral: true });
        }
      }
    }
    if (subcommand === 'delete') {
      if (!interaction.member.permissions.has('ManageMessages')) {
        await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
        return;
      }
      const key = interaction.options.getString('key');
      const stmt = db.prepare('DELETE FROM templates WHERE key = ?');
      const result = stmt.run(key);
      if (result.changes > 0) {
        await interaction.reply(`âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      } else {
        await interaction.reply({ content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${key}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
      }
    }
  }

  if (interaction.commandName === 'sos') {
    const stmt = db.prepare('SELECT content FROM templates WHERE key = ?');
    const row = stmt.get('emergency');
    if (row) {
      await interaction.reply(row.content);
    } else {
      await interaction.reply('ğŸ“ ç·Šæ€¥é€£çµ¡å…ˆ\n\nâ€¢ ã„ã®ã¡ã®é›»è©±: 0570-783-556 (24æ™‚é–“)\nâ€¢ ã“ã“ã‚ã®å¥åº·ç›¸è«‡: 0570-064-556\n\nä¸€äººã§æŠ±ãˆè¾¼ã¾ãªã„ã§ãã ã•ã„ã€‚');
    }
  }

  if (interaction.commandName === 'keyword') {
    if (!interaction.member.permissions.has('ManageMessages')) {
      await interaction.reply({ content: 'ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚', ephemeral: true });
      return;
    }
    const subcommand = interaction.options.getSubcommand();
    if (subcommand === 'add') {
      const keyword = interaction.options.getString('keyword');
      const templateKey = interaction.options.getString('template');
      const priority = interaction.options.getInteger('priority') || 5;
      const checkStmt = db.prepare('SELECT key FROM templates WHERE key = ?');
      if (!checkStmt.get(templateKey)) {
        await interaction.reply({ content: `âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ '${templateKey}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
        return;
      }
      const stmt = db.prepare(`INSERT INTO keyword_responses (keyword, template_key, priority) VALUES (?, ?, ?)`);
      stmt.run(keyword, templateKey, priority);
      await interaction.reply(`âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ '${keyword}' ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ˆå„ªå…ˆåº¦: ${priority}ï¼‰`);
    }
    if (subcommand === 'list') {
      const stmt = db.prepare(`SELECT id, keyword, template_key, priority, enabled FROM keyword_responses ORDER BY priority DESC, keyword`);
      const keywords = stmt.all();
      if (keywords.length === 0) {
        await interaction.reply('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }
      let message = '**ğŸ”‘ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**\n\n';
      keywords.forEach(kw => {
        const status = kw.enabled ? 'âœ…' : 'âŒ';
        message += `${status} ID:${kw.id} | ã€Œ${kw.keyword}ã€ â†’ \`${kw.template_key}\` (å„ªå…ˆåº¦: ${kw.priority})\n`;
      });
      await interaction.reply(message);
    }
    if (subcommand === 'delete') {
      const id = interaction.options.getInteger('id');
      const stmt = db.prepare('DELETE FROM keyword_responses WHERE id = ?');
      const result = stmt.run(id);
      if (result.changes > 0) {
        await interaction.reply(`âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID ${id} ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      } else {
        await interaction.reply({ content: `âŒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID ${id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`, ephemeral: true });
      }
    }
  }
});

// ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©
client.on('interactionCreate', async interaction => {
  if (!interaction.isAutocomplete()) return;
  if (interaction.commandName === 'template') {
    const focusedValue = interaction.options.getFocused();
    const stmt = db.prepare('SELECT key FROM templates WHERE key LIKE ? LIMIT 25');
    const choices = stmt.all(`%${focusedValue}%`);
    await interaction.respond(choices.map(choice => ({ name: choice.key, value: choice.key })));
  }
});

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©
client.on('messageCreate', async message => {
  if (message.author.bot) return;
  if (message.system) return;
  const content = message.content.toLowerCase();
  const stmt = db.prepare(`
    SELECT kr.keyword, kr.template_key, kr.priority, t.content 
    FROM keyword_responses kr
    JOIN templates t ON kr.template_key = t.key
    WHERE kr.enabled = 1 AND LOWER(?) LIKE '%' || LOWER(kr.keyword) || '%'
    ORDER BY kr.priority DESC, kr.keyword DESC LIMIT 1
  `);
  const match = stmt.get(content);
  if (match) {
    if (match.priority >= 100) {
      await message.reply(match.content);
      return;
    }
    if (match.priority >= 10) {
      await message.reply({ content: `${match.content}\n\nå¿…è¦ã§ã‚ã‚Œã° \`/sos\` ã§ç·Šæ€¥é€£çµ¡å…ˆã‚’ç¢ºèªã§ãã¾ã™ã€‚`, allowedMentions: { repliedUser: false } });
      return;
    }
    await message.reply({ content: `ğŸ’¡ \`/template get ${match.template_key}\` ãŒå½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚`, allowedMentions: { repliedUser: false } });
  }
});

client.login(process.env.DISCORD_TOKEN);
```
---

### register-commands.js
```
require('dotenv').config();
const { REST, Routes } = require('discord.js');

const commands = [
  { name: 'hello', description: 'æŒ¨æ‹¶ã—ã¾ã™' },
  { name: 'save', description: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã™', options: [{ name: 'message', description: 'ä¿å­˜ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', type: 3, required: true }] },
  { name: 'read', description: 'æœ€å¾Œã«ä¿å­˜ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿å‡ºã—ã¾ã™' },
  { name: 'feeling', description: 'ä»Šã®æ°—åˆ†ã‚’è¨˜éŒ²ã—ã¾ã™', options: [
    { name: 'mood', description: 'æ°—åˆ†ã‚’é¸ã‚“ã§ãã ã•ã„', type: 3, required: true, choices: [
      { name: 'ğŸ˜Š ã¨ã¦ã‚‚è‰¯ã„ (great)', value: 'great' }, { name: 'ğŸ™‚ è‰¯ã„ (good)', value: 'good' },
      { name: 'ğŸ˜ æ™®é€š (okay)', value: 'okay' }, { name: 'ğŸ˜” å°‘ã—è¾›ã„ (down)', value: 'down' }, { name: 'ğŸ˜¢ è¾›ã„ (bad)', value: 'bad' }
    ]},
    { name: 'note', description: 'ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰', type: 3, required: false }
  ]},
  { name: 'count', description: 'è¨˜éŒ²ã®çµ±è¨ˆã‚’è¡¨ç¤ºã—ã¾ã™' },
  { name: 'template', description: 'å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç®¡ç†ã—ã¾ã™', options: [
    { name: 'get', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—', type: 1, options: [{ name: 'key', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼', type: 3, required: true, autocomplete: true }] },
    { name: 'list', description: 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§', type: 1 },
    { name: 'add', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¿½åŠ ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰', type: 1, options: [
      { name: 'key', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼', type: 3, required: true },
      { name: 'content', description: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹', type: 3, required: true },
      { name: 'category', description: 'ã‚«ãƒ†ã‚´ãƒª', type: 3, required: false }
    ]},
    { name: 'delete', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰', type: 1, options: [{ name: 'key', description: 'å‰Šé™¤ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ¼', type: 3, required: true }] }
  ]},
  { name: 'sos', description: 'ç·Šæ€¥æ™‚ã®é€£çµ¡å…ˆã‚’è¡¨ç¤ºã—ã¾ã™' },
  { name: 'keyword', description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åå¿œã‚’ç®¡ç†ã—ã¾ã™ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰', options: [
    { name: 'add', description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ', type: 1, options: [
      { name: 'keyword', description: 'åå¿œã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰', type: 3, required: true },
      { name: 'template', description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚­ãƒ¼', type: 3, required: true },
      { name: 'priority', description: 'å„ªå…ˆåº¦ï¼ˆ1-100ã€é«˜ã„ã»ã©å„ªå…ˆï¼‰', type: 4, required: false }
    ]},
    { name: 'list', description: 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§', type: 1 },
    { name: 'delete', description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤', type: 1, options: [{ name: 'id', description: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ID', type: 4, required: true }] }
  ]}
];

const rest = new REST({ version: '10' }).setToken(process.env.DISCORD_TOKEN);
(async () => {
  try {
    console.log('ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²ä¸­...');
    await rest.put(Routes.applicationGuildCommands(process.env.CLIENT_ID, process.env.GUILD_ID), { body: commands });
    console.log('ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²å®Œäº†ï¼');
  } catch (error) {
    console.error(error);
  }
})();
```
---

### .env.example
```
DISCORD_TOKEN=ã‚ãªãŸã®ãƒˆãƒ¼ã‚¯ãƒ³
CLIENT_ID=ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID
GUILD_ID=ã‚ãªãŸã®ã‚µãƒ¼ãƒãƒ¼ID
```

---

### .gitignore
```
node_modules
.env
bot.db
*.db
```

---

### package.json
```json
{
  "name": "git_practice",
  "version": "1.0.0",
  "description": "Discord Bot ãƒãƒ³ã‚ºã‚ªãƒ³",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "discord.js": "^14.14.1",
    "better-sqlite3": "^9.2.2",
    "dotenv": "^16.3.1"
  }
}
```

ã“ã‚Œã§ç¬¬5å›ã¯å®Œæˆã§ã™ï¼

